// 钿哥增加history.js用于记录历史操作
import { derived, writable, get } from 'svelte/store';

export const savedGridStack = writable([]); 	// 常鹏：保存的网格

function createHistory() {
	const history = writable([]);
	const historyIndex = writable(-1);

	return {
		subscribe: historyIndex.subscribe,

		slice(start, end) {
			history.update($history => {
				$history = $history.slice(start, end);
				return $history;
			});
		},

		reset() {
			history.set([]);
			historyIndex.set(-1);
		},

		getHistory(index = -1) {
			if (index === -1) {
				return get(history);
			}
			return get(history)[index];
		},

		setHistory(index = -1, value) {
			if (index === -1) {
				history.set(value);
			}
			else {
				history.update($history => {
					$history[index] = value;
					return $history;
				});
			}
		},
		
		pushHistory(value) {
			historyIndex.set(get(historyIndex) + 1);
			history.update($history => {
				$history.push(value);
				return $history;
			});
		},
		
		getHistoryIndex() {
			return get(historyIndex);
		},

		setHistoryIndex(index) {
			historyIndex.set(index);
		},

		getHistoryLength() {
            return get(history).length;
		},
		

	};
}

export const history = createHistory();