import { writable, get } from 'svelte/store';

export const candidatesClicked = writable({'isValid': false, 'value': -1});//常鹏：点击了候选数

function createCandidates() {
	const candidates = writable({});

	return {
		subscribe: candidates.subscribe,

		add(pos, candidate) {
			candidates.update($candidates => {
				if (!$candidates.hasOwnProperty(pos.x + ',' + pos.y)) {
					$candidates[pos.x + ',' + pos.y] = [candidate];
				} else if ($candidates[pos.x + ',' + pos.y].includes(candidate)) {
					delete $candidates[pos.x + ',' + pos.y][$candidates[pos.x + ',' + pos.y].indexOf(candidate)];
				} else {
					$candidates[pos.x + ',' + pos.y].push(candidate);
				}

				return $candidates;
			});
		},
		
		// 邱梓钿：判断该位置是否无候选值
		noCandidates(pos) {
			return !(get(candidates).hasOwnProperty(pos.x + ',' + pos.y) && get(candidates)[pos.x + ',' + pos.y].length > 0);
		},

		clear(pos) {
			candidates.update($candidates => {
				delete $candidates[pos.x + ',' + pos.y];
				return $candidates;
			});
		},

		// 邱梓钿：增加清除所有候选值函数
		reset() {
			console.log('reset candidates');
			candidates.set({});
		}
	}
}


export const candidates = createCandidates();